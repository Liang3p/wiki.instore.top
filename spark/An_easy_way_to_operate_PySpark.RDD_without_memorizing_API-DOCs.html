<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>An easy way to operate RDD without memorizing API-DOCs - Wiki Pages</title>
    <meta name="keywords" content="bigdata hadoop hive datawarehouse spark ML"/>
    <meta name="description" content="wiki page"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#spark">spark</a>&nbsp;&#187;&nbsp;An easy way to operate RDD without memorizing API-DOCs
    <span class="updated">Page Updated&nbsp;
      2018-03-09 23:16
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">An easy way to operate RDD without memorizing API-DOCs</div>

  <div style="float:right;">
  <img src="http://spark.apache.org/docs/latest/img/spark-logo-hd.png" style="height:60px;">
</div>

<p>这是spark数据分析实践系列的第一部分:RDD操作.作为Spark框架的核心对象,RDD是开篇的不二之选.</p>
<p>本系列文档的读者对象是有一定Python编程基础和数据分析能力的开发者、数据分析师和统计建模人员,如果您对于Python编程、Spark或HDFS不甚熟悉,建议您对其先行了解.</p>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="#_1">概述</a><ul>
<li><a href="#mapreducerdd">MapReduce模式与RDD</a></li>
<li><a href="#rdd">RDD特点与操作</a><ul>
<li><a href="#_2">惰性计算</a></li>
<li><a href="#_3">函数传递</a></li>
<li><a href="#_4">洗牌</a></li>
<li><a href="#_5">持久化</a></li>
<li><a href="#_6">广播变量</a></li>
<li><a href="#_7">累加器</a></li>
</ul>
</li>
<li><a href="#api">API介绍</a><ul>
<li><a href="#_8">函数传递</a></li>
<li><a href="#mapfilter">map/filter</a></li>
<li><a href="#sumcountstat">统计函数(sum/count/stat/...)</a></li>
<li><a href="#flatmap">flatMap</a></li>
<li><a href="#fold">fold</a></li>
<li><a href="#glom">glom</a></li>
<li><a href="#zip">zip</a></li>
<li><a href="#accumulator">Accumulator</a></li>
</ul>
</li>
<li><a href="#rdddataframe">RDD总结与DataFrame初识</a><ul>
<li><a href="#rdd_1">RDD性能</a></li>
<li><a href="#dataframe">认识DataFrame</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>本文档不会讨论如下问题:<br />
1. 函数式编程类:如何在Python和Scala中使用Lambda表达式? 什么是匿名函数和闭包？<br />
2. Python数据分析类:如何操作Pandas DataFrame对象?如何使用Sci-kit Learning/MLlib构建应用?<br />
3. Spark生态系统类:Spark和HDFS的概念？如何搭建Spark环境？</p>
<p>取而代之的,我们会对如下内容形成认识或付诸实践：<br />
1. Spark RDD与MapReduce计算框架的适用场景;<br />
2. Pandas DataFrame与PySpark DataFrame异同及使用场景;<br />
3. PySpark中处理RDD与Scala/JavaAPI的性能差异,DataFrame和更高版本Spark的DataSet各自使用场景.</p>
<p>要获取更加详细的资料，请参考官方文档:<a href="http://spark.apache.org/docs/1.6.0/programming-guide.html#resilient-distributed-datasets-rdds">Spark 1.6.0 Docs - RDD Guide</a></p>
<h2 id="_1">概述</h2>
<p>弹性分布式数据集(Resilient Distributed Dataset,RDD)是Spark框架中的核心概念。可以将RDD视为数据库中的一张表。其中可以保存任何类型的数据。Spark将数据存储在不同的分区上的RDD之中。</p>
<p>RDD可以帮助重新安排计算并优化数据处理过程。</p>
<p>此外，它还具有容错性，因为RDD知道如何重新创建和重新计算数据集。RDD是不可变的。你可以用转化和操作来处理RDD对象。使用转换(Transform)将返回一个全新的RDD对象，而原有的RDD仍然保持不变。</p>
<p><strong>转换(Transform)</strong>：调用一个变换方法，不会有任何求值计算，它只获取一个RDD作为参数，然后返回一个新的RDD。转换函数包括：map，filter，flatMap，groupByKey，reduceByKey，aggregateByKey，pipe和coalesce。</p>
<p><strong>动作(Action)</strong>：计算并返回一个新的值。当在一个RDD对象上调用动作时，会在这一时刻计算全部的数据处理查询并返回结果值。动作函数包括：reduce，collect，count，first，take，countByKey以及foreach。</p>
<h3 id="mapreducerdd">MapReduce模式与RDD</h3>
<p>MapReduce将计算分解成Map阶段和Reduce阶段。由于计算是分布式的，整体数据处理能力不依赖于单机处理能力，对与计算量非常大的任务，MapReduce也能完成。理论上，随着数据量增大，只要增加worker节点，处理能力就能做到线性输出。</p>
<p>但是，MapReduce计算限制了数据转换的灵活性,所有应用都需要经过<code>Mapper()</code>和<code>Reducer()</code>实例完成,对于一个步骤不能完成的任务,便使用多个MapReduce过程来实现。在下一步开始之前，上一步的作业输出数据必须要存储到分布式文件系统中。因此，复制和磁盘存储会导致这种方式速度变慢。</p>
<p>与MapReduce不同，Spark允许开发者使用有向无环图（DAG）开发复杂的多步数据管道。而且还支持跨有向无环图的内存数据共享，以便不同的作业可以共同处理同一个数据。这就意味着，在MapReduce中需要将中间结果写入分布式文件系统时，Spark能将中间结果直接传到作业流水线的下一步。</p>
<p>例如：预处理一个给定的数据集。我们希望先应用一些规则对数据进行清洗，之后对记录进行某个转换操作，最后按照某个字段进行聚合操作，这些在构建应用模型时的常见操作对于MapReduce而言，每个步骤都要单独实现，中间结果集也将在分布式文件系统中进行多次读写，而使用Spark，只需要对RDD应用计算逻辑<code>rdd.filter().map().groupByKey()</code>即可，此类案例在spark中随处可见。</p>
<h3 id="rdd">RDD特点与操作</h3>
<h4 id="_2">惰性计算</h4>
<p>惰性计算意味着我们对RDD进行转换操作时，操作不会立即执行。Spark将数据处理逻辑应用于RDD中,使用函数式编程,函数向数据迁移,框架不需要每次访问数据都读写磁盘。定义一个RDD时，Spark并未将数据读取到客户端机器或集群内存中，当对需要对分区内的对象进行计算时，才读入输入文件的某个切片，然后应用RDD定义的转换操作。例如调用<code>sc.textFile()</code>时，数据并没有被读取进来，而在必要时才会读取。<br />
虽然RDD转换是惰性计算的，但运行一个动作函数会被立即执行，如果在这个Action之前还包含某个转换，那么依赖的转换操作会被立即执行。</p>
<h4 id="_3">函数传递</h4>
<p>使用PySpark,有三种推荐的传递函数的方法:Lambda表达式（较短的函数）、本地局部定义的函数（较长的函数）和一个模块中的顶层函数。</p>
<p>必须注意，传递函数时，如果传递的对象包含调用函数的某个成员或某个字段引用时，Python会将被调用函数所在的对象也序列化传递出去。<br />
例如:</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">def</span> <span class="nf">doStuff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdd</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
</pre></div>


<p>在这里，如果我们创建一个新的MyClass和在它上面调用doStuff，里面的map需要引用MyClass实例的func方法，所以整个对象需要被发送到集群。</p>
<p>类似的，如果被访问的字段包含对象的引用，因为存在对相应实例的依赖，整个对象也会被发送到集群。</p>
<div class="hlcode"><pre><span class="k">class</span> <span class="nc">MyClass</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span>
    <span class="k">def</span> <span class="nf">doStuff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdd</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
</pre></div>


<p>为了避免以上情况发生，我们先用本地变量获取对象的方法或引用的值，然后通过这个只有值的变量传递到集群中。</p>
<div class="hlcode"><pre><span class="k">def</span> <span class="nf">doStuff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rdd</span><span class="p">):</span>
    <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
    <span class="k">return</span> <span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">field</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span>
</pre></div>


<h4 id="_4">洗牌</h4>
<p>洗牌(Shuffer)是Spark中重分布数据、跨分区组合数据的机制。洗牌通常涉及到在执行器和机器之间复制数据，使其成为复杂而昂贵的操作。</p>
<p>了解洗牌过程中发生了什么，可以通过分析reducebykey实例来解释它。reducebykey操作产生一个在单个键的所有值组合成一个元组的RDD。面临的挑战是，单个键的所有值不一定都驻留在同一分区上，甚至是同一台机器上，但它们必须共同定位以计算结果。因此计算包含reduce操作时，Spark需要对单个键的形式对数据进行重分布，它必须从所有分区读取所有键的所有值，然后将分区上的值集合起来计算每个键的最终结果，这称为<strong>洗牌</strong>。</p>
<p>洗牌通常发生在如下情形：<br />
- 使用mapPartitions排序每个分区，例如<code>rdd.sorted</code><br />
- 分区排序的同时重分布数据:<code>rdd.repartitionAndSortWithinPartitions</code><br />
- 使RDD全局有序的操作:<code>rdd.sortBy</code></p>
<h4 id="_5">持久化</h4>
<p>默认情况下，RDD的转换操作在每次你运行Action时会被重新计算。对于需要多次复用的RDD,每次都重复进行计算，显然增加了不必要的开销。为了避免多次计算同一个RDD,可以让Spark对数据进行持久化。<br />
你可以使用<code>persist()</code>或<code>cache()</code>方法将RDD持久化到内存。</p>
<div class="hlcode"><pre><span class="n">rdd</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<p>上述代码中,<code>cache()</code>方法会在下次计算RDD之后执行，调用<code>count()</code>会导致第一次计算rdd。但调用<code>take()</code>时，访问的是rdd对象已经缓存好的元素，而不是从rdd的依赖关系中重新计算出来的。</p>
<p>事实上，Spark为RDD定制了几种不同的缓存机制。<code>rdd..cache()</code>是<code>rdd.presist(StorageLevel.MEMORY)</code>的简写。你可以通过调整StorageLevel以便控制需要的存储级别.<br />
- MEMORY:内存<br />
- MEMORY_SER:对RDD数据序列化之后写入内存<br />
- MEMORY_ONLY:仅缓存在JVM内存中<br />
- DISK_ONLY:仅缓存在磁盘中<br />
- MERORY_AND_DISK:内存和磁盘，如果分区在内存里放不下，Spark会将其溢出部分写到磁盘上<br />
- MEMORY_AND_DISK_SER:内存和磁盘，如果序列化之后的分区在内存里放不下，Spark会将其溢出部分写到磁盘上</p>
<p>Spark会自动监控在每个节点上的RDD,并删除最近最少使用的数据分区，如果不想经历它在缓存中漫长的等待过程，使用<code>rdd.unpersist()</code>手动移除数据以释放资源。</p>
<h4 id="_6">广播变量</h4>
<p>通常，在远程的集群节点上执行传递给Spark操作的函数时，它工作在函数中使用的所有变量的独立副本中。要实现共享变量，跨任务的通用读写共享变量是低效的。因此Spark将这些变量被复制到每台机器上，而对远程机器上的变量的更新不被传播回驱动程序。Spark提供了两种有限类型的共享变量：<strong>广播变量(broadcast variables)</strong>和<strong>累加器(accumulators)</strong>。</p>
<p>Spark的Action通过一系列的步骤执行，这些步骤由分布式的洗牌操作分开。Spark自动地广播每个步骤每个任务需要的通用数据。这些广播数据被序列化地缓存，在运行任务之前被反序列化出来。这意味着当我们需要在多个阶段的任务之间使用相同的数据，或者以反序列化形式缓存数据是十分重要的时候，显式地创建广播变量才有用。</p>
<p>通过在一个变量v上调用<code>SparkContext.broadcast(v)</code>可以创建广播变量。广播变量是围绕着v的封装，可以通过<code>value</code>方法访问这个变量。举例如下：</p>
<div class="hlcode"><pre><span class="n">broadcastVar</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">broadcast</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">broadcastVar</span><span class="o">.</span><span class="n">value</span>
</pre></div>


<p>在创建了广播变量之后，在集群上的所有函数中应该使用它来替代使用v.这样v就不会不止一次地在节点之间传输了。另外，为了确保所有的节点获得相同的变量，对象v在被广播之后就不应该再修改。</p>
<h4 id="_7">累加器</h4>
<p>累加器是仅仅被相关操作累加的变量，因此可以在并行中被有效地支持。它可以被用来实现计数器和总和。Spark原生地只支持数字类型的累加器，开发者可以添加新类型的支持。如果创建累加器时指定了名字，可以在Spark的UI界面看到。这有利于理解每个执行阶段的进程。（对于python还不支持）<br />
累加器通过对一个初始化了的变量v调用<code>SparkContext.accumulator(v)</code>来创建。在集群上运行的任务可以通过add或者"+="方法在累加器上进行累加操作。但是，它们不能读取它的值。只有驱动程序能够读取它的值，通过累加器的<code>value</code>方法。</p>
<h3 id="api">API介绍</h3>
<p>我们先定义sc作为默认的SparkContext:</p>
<div class="hlcode"><pre><span class="c">#!/usr/local/bin/python3.5.4</span>
<span class="kn">import</span> <span class="nn">findspark</span>
<span class="n">findspark</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkConf</span><span class="p">,</span><span class="n">SparkContext</span>

<span class="n">conf</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()</span><span class="o">.</span><span class="n">setAppName</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setMaster</span><span class="p">(</span><span class="s">&quot;local&quot;</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">sc</span><span class="p">))</span>
</pre></div>


<div class="hlcode"><pre><span class="o">&lt;</span><span class="n">class</span> <span class="err">&#39;</span><span class="n">pyspark</span><span class="p">.</span><span class="n">context</span><span class="p">.</span><span class="n">SparkContext</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="p">[</span><span class="err">&#39;</span><span class="n">PACKAGE_EXTENSIONS</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__class__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__delattr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__dict__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__dir__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__doc__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__enter__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__eq__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__exit__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__format__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__ge__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__getattribute__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__getnewargs__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__gt__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__hash__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__init__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__le__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__lt__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__module__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__ne__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__new__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__reduce__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__reduce_ex__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__repr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__setattr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__sizeof__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__str__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__subclasshook__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__weakref__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_accumulatorServer</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_active_spark_context</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_batchSize</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_callsite</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_checkpointFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_conf</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_dictToJavaMap</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_do_init</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_ensure_initialized</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_gateway</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_getJavaStorageLevel</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_initialize_context</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_javaAccumulator</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_jsc</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_jvm</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_lock</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_next_accum_id</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_pickled_broadcast_vars</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_python_includes</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_temp_dir</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_unbatched_serializer</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">accumulator</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">addFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">addPyFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">appName</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">applicationId</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">binaryFiles</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">binaryRecords</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">broadcast</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">cancelAllJobs</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">cancelJobGroup</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">clearFiles</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">defaultMinPartitions</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">defaultParallelism</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">dump_profiles</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">emptyRDD</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">environment</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">getLocalProperty</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">getOrCreate</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">hadoopFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">hadoopRDD</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">master</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">newAPIHadoopFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">newAPIHadoopRDD</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">parallelize</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">pickleFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">profiler_collector</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">pythonExec</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">pythonVer</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">range</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">runJob</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sequenceFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">serializer</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">setCheckpointDir</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">setJobGroup</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">setLocalProperty</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">setLogLevel</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">setSystemProperty</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">show_profiles</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sparkHome</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sparkUser</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">startTime</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">statusTracker</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">stop</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">textFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="k">union</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">version</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">wholeTextFiles</span><span class="err">&#39;</span><span class="p">]</span>
</pre></div>


<h4 id="_8">函数传递</h4>
<div class="hlcode"><pre><span class="n">fib</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span><span class="n">a</span> <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mi">2</span> <span class="k">else</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
<span class="n">fibonacci</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fibonacci</span><span class="p">)</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="k">print</span><span class="p">)</span><span class="c">#未被Jypyter捕获的标准输出</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">end</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span> <span class="c">#</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">fibonacci</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">)</span> 
</pre></div>


<div class="hlcode"><pre>  <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">5</span>  <span class="mi">8</span>  <span class="mi">13</span>  <span class="mi">21</span>  <span class="mi">34</span>  <span class="mi">55</span>  <span class="mi">89</span>  <span class="mi">144</span>  <span class="mi">233</span>  <span class="mi">377</span>  <span class="mi">610</span>  <span class="mi">987</span>  <span class="mi">1597</span>  <span class="mi">2584</span>  <span class="mi">4181</span>
  <span class="mi">1</span>  <span class="mi">1</span>  <span class="mi">2</span>  <span class="mi">3</span>  <span class="mi">5</span>  <span class="mi">8</span>  <span class="mi">13</span>  <span class="mi">21</span>  <span class="mi">34</span>  <span class="mi">55</span>  <span class="mi">89</span>  <span class="mi">144</span>  <span class="mi">233</span>  <span class="mi">377</span>  <span class="mi">610</span>  <span class="mi">987</span>  <span class="mi">1597</span>  <span class="mi">2584</span>  <span class="mi">4181</span>
</pre></div>


<h4 id="mapfilter">map/filter</h4>
<div class="hlcode"><pre><span class="c">#函数式写法</span>
<span class="n">seq</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">seq_fmap</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">,</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">seq</span><span class="p">))</span>
<span class="c">#apply(print,seq_fmap) #in Python2.x,经典写法</span>
<span class="k">print</span><span class="p">(</span><span class="o">*</span><span class="n">seq_fmap</span><span class="p">)</span> <span class="c">#Python3.x，使用时加星号</span>

<span class="c">#PySpark</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">rdd_fmap</span> <span class="o">=</span> <span class="n">rdd</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="o">*</span><span class="n">rdd_fmap</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rdd</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">rdd</span><span class="p">))</span>
</pre></div>


<div class="hlcode"><pre><span class="o">-</span><span class="mi">9</span> <span class="o">-</span><span class="mi">7</span> <span class="o">-</span><span class="mi">5</span> <span class="o">-</span><span class="mi">3</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">9</span>
<span class="o">-</span><span class="mi">9</span> <span class="o">-</span><span class="mi">7</span> <span class="o">-</span><span class="mi">5</span> <span class="o">-</span><span class="mi">3</span> <span class="o">-</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">9</span>
<span class="o">&lt;</span><span class="n">class</span> <span class="err">&#39;</span><span class="n">pyspark</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="n">PipelinedRDD</span><span class="err">&#39;</span><span class="o">&gt;</span>
<span class="p">[</span><span class="err">&#39;</span><span class="n">__add__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__class__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__delattr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__dict__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__dir__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__doc__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__eq__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__format__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__ge__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__getattribute__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__getnewargs__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__gt__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__hash__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__init__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__le__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__lt__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__module__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__ne__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__new__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__reduce__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__reduce_ex__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__repr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__setattr__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__sizeof__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__str__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__subclasshook__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">__weakref__</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_bypass_serializer</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_computeFractionForSampleSize</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_defaultReducePartitions</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_id</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_is_pipelinable</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_jrdd</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_jrdd_deserializer</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_jrdd_val</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_memory_limit</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_pickled</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_prev_jrdd</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_prev_jrdd_deserializer</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_reserialize</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">_to_java_object_rdd</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">aggregate</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">aggregateByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">cache</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">cartesian</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">checkpoint</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">coalesce</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">cogroup</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">collect</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">collectAsMap</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">combineByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">context</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">count</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">countApprox</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">countApproxDistinct</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">countByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">countByValue</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">ctx</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">distinct</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">filter</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">first</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">flatMap</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">flatMapValues</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">fold</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">foldByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">foreach</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">foreachPartition</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">fullOuterJoin</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">func</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">getCheckpointFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">getNumPartitions</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">getStorageLevel</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">glom</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">groupBy</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">groupByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">groupWith</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">histogram</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">id</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">intersection</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">isCheckpointed</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">isEmpty</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">is_cached</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">is_checkpointed</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">join</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">keyBy</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">keys</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">leftOuterJoin</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">lookup</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">map</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">mapPartitions</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">mapPartitionsWithIndex</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">mapPartitionsWithSplit</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">mapValues</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">max</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">mean</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">meanApprox</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">min</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">name</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">partitionBy</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">partitioner</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">persist</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">pipe</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">preservesPartitioning</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">prev</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">randomSplit</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">reduce</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">reduceByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">reduceByKeyLocally</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">repartition</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">repartitionAndSortWithinPartitions</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">rightOuterJoin</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sample</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sampleByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sampleStdev</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sampleVariance</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">saveAsHadoopDataset</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">saveAsHadoopFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">saveAsNewAPIHadoopDataset</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">saveAsNewAPIHadoopFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">saveAsPickleFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">saveAsSequenceFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">saveAsTextFile</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">setName</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sortBy</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sortByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">stats</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">stdev</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">subtract</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">subtractByKey</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sum</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">sumApprox</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">take</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">takeOrdered</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">takeSample</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">toDebugString</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">toLocalIterator</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">top</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">treeAggregate</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">treeReduce</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="k">union</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">unpersist</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">values</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">variance</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">zip</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">zipWithIndex</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">zipWithUniqueId</span><span class="err">&#39;</span><span class="p">]</span>
</pre></div>


<h4 id="sumcountstat">统计函数(sum/count/stat/...)</h4>
<div class="hlcode"><pre><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">iris</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">load_iris</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">iris</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;sum:</span><span class="si">%.1f</span><span class="s">,count:</span><span class="si">%d</span><span class="s">,min:</span><span class="si">%.1f</span><span class="s">,max:</span><span class="si">%.1f</span><span class="s">,mean:</span><span class="si">%.4f</span><span class="s">,stdev:</span><span class="si">%.4f</span><span class="s">,variance:</span><span class="si">%.4f</span><span class="s">,sampleStdev:</span><span class="si">%.4f</span><span class="s">,sampleVariance:</span><span class="si">%.4f</span><span class="se">\n</span><span class="s">stats:</span><span class="si">%s</span><span class="s">&quot;</span> \
      <span class="o">%</span><span class="p">(</span><span class="n">rdd</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">stdev</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">variance</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">sampleStdev</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">sampleVariance</span><span class="p">(),</span><span class="n">rdd</span><span class="o">.</span><span class="n">stats</span><span class="p">()))</span>
</pre></div>


<div class="hlcode"><pre>     <span class="mi">0</span>    <span class="mi">1</span>    <span class="mi">2</span>    <span class="mi">3</span>
<span class="mi">0</span>  <span class="mf">5.1</span>  <span class="mf">3.5</span>  <span class="mf">1.4</span>  <span class="mf">0.2</span>
<span class="mi">1</span>  <span class="mf">4.9</span>  <span class="mf">3.0</span>  <span class="mf">1.4</span>  <span class="mf">0.2</span>
<span class="mi">2</span>  <span class="mf">4.7</span>  <span class="mf">3.2</span>  <span class="mf">1.3</span>  <span class="mf">0.2</span>
<span class="mi">3</span>  <span class="mf">4.6</span>  <span class="mf">3.1</span>  <span class="mf">1.5</span>  <span class="mf">0.2</span>
<span class="mi">4</span>  <span class="mf">5.0</span>  <span class="mf">3.6</span>  <span class="mf">1.4</span>  <span class="mf">0.2</span>
<span class="nl">sum:</span><span class="mf">876.5</span><span class="p">,</span><span class="n">count</span><span class="o">:</span><span class="mi">150</span><span class="p">,</span><span class="n">min</span><span class="o">:</span><span class="mf">4.3</span><span class="p">,</span><span class="n">max</span><span class="o">:</span><span class="mf">7.9</span><span class="p">,</span><span class="n">mean</span><span class="o">:</span><span class="mf">5.8433</span><span class="p">,</span><span class="n">stdev</span><span class="o">:</span><span class="mf">0.8253</span><span class="p">,</span><span class="n">variance</span><span class="o">:</span><span class="mf">0.6811</span><span class="p">,</span><span class="n">sampleStdev</span><span class="o">:</span><span class="mf">0.8281</span><span class="p">,</span><span class="n">sampleVariance</span><span class="o">:</span><span class="mf">0.6857</span>
<span class="nl">stats:</span><span class="p">(</span><span class="n">count</span><span class="o">:</span> <span class="mi">150</span><span class="p">,</span> <span class="n">mean</span><span class="o">:</span> <span class="mf">5.843333333333333</span><span class="p">,</span> <span class="n">stdev</span><span class="o">:</span> <span class="mf">0.825301291785</span><span class="p">,</span> <span class="n">max</span><span class="o">:</span> <span class="mf">7.9</span><span class="p">,</span> <span class="n">min</span><span class="o">:</span> <span class="mf">4.3</span><span class="p">)</span>
</pre></div>


<h4 id="flatmap">flatMap</h4>
<div class="hlcode"><pre><span class="k">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">collect</span><span class="p">()))</span>
</pre></div>


<div class="hlcode"><pre><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>


<h4 id="fold">fold</h4>
<div class="hlcode"><pre><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span>
<span class="k">print</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span><span class="o">.</span><span class="n">fold</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">add</span><span class="p">))</span>
</pre></div>


<div class="hlcode"><pre><span class="mi">15</span>
</pre></div>


<h4 id="glom">glom</h4>
<div class="hlcode"><pre><span class="k">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">glom</span><span class="p">()</span><span class="o">.</span><span class="n">collect</span><span class="p">()))</span>
</pre></div>


<div class="hlcode"><pre><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span>
</pre></div>


<h4 id="zip">zip</h4>
<div class="hlcode"><pre><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">iris</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">load_iris</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">load_iris</span><span class="p">()</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">iris</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">())</span>

<span class="c"># http://www.aboutyun.com/thread-20902-1-1.html</span>
</pre></div>


<div class="hlcode"><pre><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">23</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">33</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">38</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">39</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">43</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">44</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">47</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">49</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">51</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">52</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">53</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">54</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">55</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">56</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">57</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">58</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">59</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">61</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">62</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">63</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">65</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">66</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">67</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">68</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">69</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">71</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">73</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">74</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">76</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">77</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">78</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">79</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">81</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">82</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">83</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">84</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">86</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">87</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">88</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">89</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">91</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">92</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">93</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">94</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">97</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">98</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">101</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">102</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">103</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">105</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">106</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">107</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">109</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">112</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">113</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">115</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">116</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">117</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">118</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">119</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">120</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">121</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">124</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">126</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">127</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">129</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">130</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">131</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">132</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">133</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">134</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">135</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">136</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">137</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">138</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">139</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">140</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">141</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">142</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">143</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">144</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">145</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">146</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">147</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">148</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">149</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
</pre></div>


<h4 id="accumulator">Accumulator</h4>
<div class="hlcode"><pre><span class="c"># 累加器</span>
<span class="n">accum</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">accumulator</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">parallelize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">rdd</span><span class="o">.</span><span class="n">foreach</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">accum</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">accum</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">id=</span><span class="si">%d</span><span class="s">, value=</span><span class="si">%d</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">accum</span><span class="o">.</span><span class="n">aid</span><span class="p">,</span> <span class="n">accum</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
<span class="n">accum</span>
</pre></div>


<div class="hlcode"><pre><span class="k">[&#39;__class__&#39;, &#39;__delattr__&#39;, &#39;__dict__&#39;, &#39;__dir__&#39;, &#39;__doc__&#39;, &#39;__eq__&#39;, &#39;__format__&#39;, &#39;__ge__&#39;, &#39;__getattribute__&#39;, &#39;__gt__&#39;, &#39;__hash__&#39;, &#39;__iadd__&#39;, &#39;__init__&#39;, &#39;__le__&#39;, &#39;__lt__&#39;, &#39;__module__&#39;, &#39;__ne__&#39;, &#39;__new__&#39;, &#39;__reduce__&#39;, &#39;__reduce_ex__&#39;, &#39;__repr__&#39;, &#39;__setattr__&#39;, &#39;__sizeof__&#39;, &#39;__str__&#39;, &#39;__subclasshook__&#39;, &#39;__weakref__&#39;, &#39;_deserialized&#39;, &#39;_value&#39;, &#39;accum_param&#39;, &#39;add&#39;, &#39;aid&#39;, &#39;value&#39;]</span>

<span class="na">id</span><span class="o">=</span><span class="s">0, value=10</span>





<span class="na">Accumulator&lt;id</span><span class="o">=</span><span class="s">0, value=10&gt;</span>
</pre></div>


<h3 id="rdddataframe">RDD总结与DataFrame初识</h3>
<h4 id="rdd_1">RDD性能</h4>
<p>Spark最初只有RDD，DataFrame在Spark 1.3中被首次发布，DataSet在Spark1.6版本中被加入。<br />
虽然Spark支持使用多种语言进行编程，Python也拥有和Scala相似的API，但是在RDD的计算速度上前者相比后者显著要慢。PySpark中所有操作都要经历py4j与JVM之间通信成本，Python环境与JVM环境多次上下文切换，构成了PySpark性能影响的关键因素。Catalyst优化器项目，使得PySpark在数据处理上性能大幅提升。Python与Scala对DataFrame的处理性能趋于均衡。</p>
<p>详细标准测试结果请参考：<a href="https://gist.github.com/rxin/c1592c133e4bccf515dd">DataFrame simple aggregation performance benchmark</a><br />
<img alt="" src="https://databricks.com/wp-content/uploads/2015/02/Screen-Shot-2015-02-16-at-9.46.39-AM.png" /></p>
<p><a href="https://databricks.com/blog/2015/02/17/introducing-dataframes-in-spark-for-large-scale-data-science.html">Introducing DataFrames in Apache Spark for Large Scale Data Science</a></p>
<h4 id="dataframe">认识DataFrame</h4>
<p>Spark中DataFrame与Pandas DataFrame相似却又不同。<br />
Spark中的DataFrame继承了RDD的函数式编程，支持比RDD更高阶的函数，同时它是面向HDFS集群操作的。</p>
<p><a href="http://www.aboutyun.com/thread-20902-1-1.html">spark core组件:RDD、DataFrame和DataSet介绍、场景与比较</a><br />
<a href="http://www.jianshu.com/p/c0181667daa0">RDD、DataFrame和DataSet的区别</a><br />
<a href="http://developer.51cto.com/art/201603/507668.htm">RDD、DataFrame和DataSet的区别是什么</a><br />
<a href="https://www.cnblogs.com/starwater/p/6841807.html">谈谈RDD、DataFrame、Dataset的区别和各自的优势</a><br />
<a href="http://blog.csdn.net/dabokele/article/details/52802150">Spark-SQL之DataFrame操作大全</a></p>
<p><class 'pyspark.rdd.PipelinedRDD'><br />
['<strong>add</strong>', '<strong>class</strong>', '<strong>delattr</strong>', '<strong>dict</strong>', '<strong>dir</strong>', '<strong>doc</strong>', '<strong>eq</strong>', '<strong>format</strong>', '<strong>ge</strong>', '<strong>getattribute</strong>', '<strong>getnewargs</strong>', '<strong>gt</strong>', '<strong>hash</strong>', '<strong>init</strong>', '<strong>le</strong>', '<strong>lt</strong>', '<strong>module</strong>', '<strong>ne</strong>', '<strong>new</strong>', '<strong>reduce</strong>', '<strong>reduce_ex</strong>', '<strong>repr</strong>', '<strong>setattr</strong>', '<strong>sizeof</strong>', '<strong>str</strong>', '<strong>subclasshook</strong>', '<strong>weakref</strong>', '_bypass_serializer', '_computeFractionForSampleSize', '_defaultReducePartitions', '_id', '_is_pipelinable', '_jrdd', '_jrdd_deserializer', '_jrdd_val', '_memory_limit', '_pickled', '_prev_jrdd', '_prev_jrdd_deserializer', '_reserialize', '_to_java_object_rdd', 'aggregate', 'aggregateByKey', 'cache', 'cartesian', 'checkpoint', 'coalesce', 'cogroup', 'collect', 'collectAsMap', 'combineByKey', 'context', 'count', 'countApprox', 'countApproxDistinct', 'countByKey', 'countByValue', 'ctx', 'distinct', 'filter', 'first', 'flatMap', 'flatMapValues', 'fold', 'foldByKey', 'foreach', 'foreachPartition', 'fullOuterJoin', 'func', 'getCheckpointFile', 'getNumPartitions', 'getStorageLevel', 'glom', 'groupBy', 'groupByKey', 'groupWith', 'histogram', 'id', 'intersection', 'isCheckpointed', 'isEmpty', 'is_cached', 'is_checkpointed', 'join', 'keyBy', 'keys', 'leftOuterJoin', 'lookup', 'map', 'mapPartitions', 'mapPartitionsWithIndex', 'mapPartitionsWithSplit', 'mapValues', 'max', 'mean', 'meanApprox', 'min', 'name', 'partitionBy', 'partitioner', 'persist', 'pipe', 'preservesPartitioning', 'prev', 'randomSplit', 'reduce', 'reduceByKey', 'reduceByKeyLocally', 'repartition', 'repartitionAndSortWithinPartitions', 'rightOuterJoin', 'sample', 'sampleByKey', 'sampleStdev', 'sampleVariance', 'saveAsHadoopDataset', 'saveAsHadoopFile', 'saveAsNewAPIHadoopDataset', 'saveAsNewAPIHadoopFile', 'saveAsPickleFile', 'saveAsSequenceFile', 'saveAsTextFile', 'setName', 'sortBy', 'sortByKey', 'stats', 'stdev', 'subtract', 'subtractByKey', 'sum', 'sumApprox', 'take', 'takeOrdered', 'takeSample', 'toDebugString', 'toLocalIterator', 'top', 'treeAggregate', 'treeReduce', 'union', 'unpersist', 'values', 'variance', 'zip', 'zipWithIndex', 'zipWithUniqueId']</p>
<p><class 'pyspark.sql.dataframe.DataFrame'><br />
['<strong>class</strong>', '<strong>delattr</strong>', '<strong>dict</strong>', '<strong>dir</strong>', '<strong>doc</strong>', '<strong>eq</strong>', '<strong>format</strong>', '<strong>ge</strong>', '<strong>getattr</strong>', '<strong>getattribute</strong>', '<strong>getitem</strong>', '<strong>gt</strong>', '<strong>hash</strong>', '<strong>init</strong>', '<strong>le</strong>', '<strong>lt</strong>', '<strong>module</strong>', '<strong>ne</strong>', '<strong>new</strong>', '<strong>reduce</strong>', '<strong>reduce_ex</strong>', '<strong>repr</strong>', '<strong>setattr</strong>', '<strong>sizeof</strong>', '<strong>str</strong>', '<strong>subclasshook</strong>', '<strong>weakref</strong>', '_jcols', '_jdf', '_jmap', '_jseq', '_lazy_rdd', '_sc', '_schema', '_sort_cols', 'agg', 'alias', 'cache', 'coalesce', 'collect', 'columns', 'corr', 'count', 'cov', 'crosstab', 'cube', 'describe', 'distinct', 'drop', 'dropDuplicates', 'drop_duplicates', 'dropna', 'dtypes', 'explain', 'fillna', 'filter', 'first', 'flatMap', 'foreach', 'foreachPartition', 'freqItems', 'groupBy', 'groupby', 'head', 'insertInto', 'intersect', 'isLocal', 'is_cached', 'join', 'limit', 'map', 'mapPartitions', 'na', 'orderBy', 'persist', 'printSchema', 'randomSplit', 'rdd', 'registerAsTable', 'registerTempTable', 'repartition', 'replace', 'rollup', 'sample', 'sampleBy', 'save', 'saveAsParquetFile', 'saveAsTable', 'schema', 'select', 'selectExpr', 'show', 'sort', 'sortWithinPartitions', 'sql_ctx', 'stat', 'subtract', 'take', 'toDF', 'toJSON', 'toPandas', 'unionAll', 'unpersist', 'where', 'withColumn', 'withColumnRenamed', 'write']</p>
  <div class="relation">
    <h2>Related</h2>
    <ul>
    
    <li><a href="/others/ANTLR4实现计算器的理解.html">ANTLR4实现计算器的理解</a></li>
    
    </ul>
  </div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2018 instore.top.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2018-04-03 18:46:53</p>
      </span>
    </div>

    
    
  </body>
</html>